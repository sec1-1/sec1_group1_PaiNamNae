meta {
  name: 05User Reserve Route
  type: http
  seq: 1
}

post {
  url: {{base_url}}/api/bookings
  body: json
  auth: bearer
}

auth:bearer {
  token: {{passenger_token}}
}

body:json {
  {
    "routeId": "{{routeId}}",
    "numberOfSeats": 1,
    "pickupLocation": {
      "lat": 16.4419,
      "lng": 102.8359,
      "name": "KKU Gate 1"
    },
    "dropoffLocation": {
      "lat": 16.4740,
      "lng": 102.8230,
      "name": "Central Khonkaen"
    }
  }
  
}

tests {
  const body = res.getBody();
  const json = typeof body === "string" ? JSON.parse(body) : body;
  
  test("Reserve: status 200 หรือ 201", () => {
    expect([200, 201]).to.include(res.getStatus());
  });
  
  test("success ต้องเป็น true", () => {
    expect(json).to.have.property("success");
    expect(json.success).to.equal(true);
  });
  
  test("ต้องได้ bookingId", () => {
    expect(json).to.have.property("data");
    expect(json.data).to.have.property("id");
    expect(json.data.id).to.be.a("string");
    expect(json.data.id).to.not.be.empty;
  });
  
  // save bookingId
  bru.setEnvVar("bookingId", json.data.id);
  
}

settings {
  encodeUrl: true
  timeout: 0
}
